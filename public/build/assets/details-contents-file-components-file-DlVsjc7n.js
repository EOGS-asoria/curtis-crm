import{q as y,r as s,j as r,s as _}from"./store-CorJ7S5Q.js";import{u as P}from"./app-CZCG2jH_.js";import{u as U}from"./customer-tickets-thunk-Ckg1Zmb9.js";import{U as C,I as c,P as O}from"./index-CI-j2gtf.js";import"./tickets-service-BEB5ZAFm.js";import"./files-service-BVmT_30U.js";import"./compact-item-PVVCWA33.js";import"./addEventListener-DpEWNk2R.js";import"./index-B0_OPhdT.js";import"./motion-L0wigdRl.js";import"./roundedArrow-Dpf_COos.js";import"./reactNode-3bav4zo4.js";import"./zoom-B1l6vkCP.js";import"./colors-BGWxqRzT.js";import"./index-CHfOMkTP.js";import"./useForceUpdate-VXAcl-Za.js";import"./collapse-C1MjllT7.js";import"./button-Bob1Tl1g.js";import"./index-CNpigZnu.js";import"./DeleteOutlined-Bx_9Kl_i.js";const W=({files:m,type:h})=>{const{user:g}=P(e=>e.app),{url:a}=y(),[w,d]=s.useState(!1),[l,u]=s.useState(""),[i,p]=s.useState([]);s.useEffect(()=>{p([...i,...m.map(e=>({uid:e.id,name:"uploaded",url:e.url,status:"done",extension:e.url.split("/").pop().split(".").pop()}))])},[]);const v=async e=>{try{if(e.extension=="pdf")window.open(e.url,"_blank");else if(e.extension=="docx"){const t=encodeURIComponent(e.url);window.open(`https://docs.google.com/gview?url=${t}&embedded=true`,"_blank")}else["mp4","webm","ogg","mov"].includes(e.extension)?window.open(e.url,"_blank"):(!e.url&&!e.preview&&(e.preview=await f(e.originFileObj)),u(e.url||e.preview),d(!0))}catch(t){console.error("Error handling file preview:",t)}},f=e=>new Promise((t,n)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>t(o.result),o.onerror=k=>n(k)});function x(e){return!e.some(n=>n.status!=="done")}async function b({fileList:e}){const t=new FormData,n=a.split("/")[a.split("/").length-2].split("#")[0];if(t.append("ticket_id",n=="tickets"?window.location.pathname.split("/")[3]:n),t.append("user_id",g.id),t.append("type",h),x(e))for(let o=0;o<e.length;o++)e[o].name!=="uploaded"&&e[o].status=="done"&&(t.append("files[]",e[o].originFileObj),p(e));else p(e);await _.dispatch(U(t,n))}const j=r.jsxs("button",{style:{border:0,background:"none"},type:"button",children:[r.jsx(O,{}),r.jsx("div",{style:{marginTop:8},children:"Upload"})]});return r.jsxs(r.Fragment,{children:[r.jsx(C,{multiple:!0,method:"GET",action:"https://660d2bd96ddfa2943b33731c.mockapi.io/api/upload",listType:"picture-card",fileList:i,onPreview:v,onChange:b,children:i.length>=8?null:j}),l&&r.jsx(c.PreviewGroup,{preview:{visible:w,onVisibleChange:e=>d(e),afterOpenChange:e=>!e&&u("")},children:r.jsx(c,{wrapperStyle:{display:"none"},src:l})})]})};export{W as default};
