import{r as d,j as e,s as F}from"./page-ch7AsIzP.js";import{u as H}from"./app-B_UtBjKo.js";import{v as J,u as K}from"./tickets-service-CKn-hEjY.js";import{u as l,w as Q}from"./xlsx-769MyM77.js";import{h as M}from"./page-CfrH9CDr.js";import{g as R}from"./tickets-thunk-uBkgddiA.js";import{B as _}from"./button-Qo8-TZ9g.js";import{M as X}from"./index-BACUEx04.js";import{R as p}from"./index-CnKFXJpZ.js";import{S as Y}from"./index-CUqrCOI5.js";import"./index-k6KU01t5.js";import"./internals-service-B9kSbxh_.js";import"./asyncToGenerator-1G8vEj8s.js";import"./compact-item-DdTtj5So.js";import"./render-BVKagQI8.js";import"./CheckCircleFilled-Decm9dyN.js";import"./pickAttrs-SrrbshNR.js";import"./InfoCircleFilled-eQBaOCtc.js";import"./useZIndex-CaQg4lWk.js";import"./motion-4S5rSXvC.js";import"./Modal-4B6JKVfO.js";import"./index-B88Ejp4W.js";import"./index-mf6ioYG1.js";import"./KeyCode-DNlgD2sM.js";import"./fade-BRA5nTkl.js";import"./zoom-DSCnx-FX.js";import"./ContextIsolator-DeP6EsIi.js";import"./useClosable-CLTPwS5-.js";import"./useCSSVarCls-ChRbnEBV.js";import"./useLocale-De3Ei8eB.js";import"./PurePanel-CteU8erQ.js";import"./Overflow-2UsTlSiO.js";import"./useIcons-DJhXt3_u.js";function Ma({selected:u}){const[q,h]=d.useState(!1),[P,f]=d.useState(!1);H(i=>i.tickets);const[c,L]=d.useState("all"),[A,T]=d.useState([]),N=[{id:0,name:"Date Created"},{id:1,name:"Date Last Updated"},{id:2,name:"Ticket #"},{id:3,name:"First Name"},{id:4,name:"Last Name"},{id:5,name:"Phone"},{id:6,name:"Email"},{id:7,name:"Serial #"},{id:8,name:"Model #"},{id:9,name:"Unit"},{id:10,name:"Item Class"},{id:11,name:"Brand"},{id:12,name:"Resolution"},{id:13,name:"Purchase Date"},{id:14,name:"Zipcode"},{id:15,name:"Country"},{id:16,name:"State"},{id:17,name:"City"},{id:18,name:"Address"},{id:19,name:"Issue"},{id:20,name:"Ticket Status"},{id:21,name:"Reason"},{id:22,name:"Discount"},{id:23,name:"Price After Discount"},{id:24,name:"Purchase Price"},{id:25,name:"Cost Price"},{id:26,name:"Shipping Cost"},{id:27,name:"Replacement Ship Date"},{id:28,name:"Tracking #"},{id:29,name:"Cheque Ship Date"},{id:30,name:"Cheque #"},{id:31,name:"Cheque Amount"},{id:32,name:"Cheque Currency"},{id:33,name:"Retail Store"}],B=i=>{console.log("selected ",i),T(i)},U=i=>{console.log("radio checked",i.target.value),L(i.target.value)},O=()=>{f(!0)};console.log("selected",u);const I=async()=>{h(!0),console.log(window.location.search);const i=await J(window.location.search);async function s(a){if(c=="all")return i.data;if(c=="uncheck")return i.data.filter(t=>!u.includes(t.id));if(c=="checked")return i.data.filter(t=>u.includes(t.id))}async function z(a){return N.filter(t=>A.includes(t.id))}const G=(await s()).map(a=>{var t,n,r,w,S,y,b,v,j,D,E;return{0:{id:0,name:M(a.created_at).format("L")},1:{id:1,name:M(a.updated_at).format("L")},2:{id:2,name:(a==null?void 0:a.ticket_id)??"N/A"},3:{id:3,name:(a==null?void 0:a.fname)??"N/A"},4:{id:4,name:(a==null?void 0:a.lname)??"N/A"},5:{id:5,name:(a==null?void 0:a.phone)??"N/A"},6:{id:6,name:(a==null?void 0:a.email)??"N/A"},7:{id:7,name:(a==null?void 0:a.serial_number)??"N/A"},8:{id:8,name:(a==null?void 0:a.item_number)??"N/A"},9:{id:9,name:(a==null?void 0:a.unit)??"N/A"},10:{id:10,name:(a==null?void 0:a.class)??"N/A"},11:{id:11,name:(a==null?void 0:a.brand)??"N/A"},12:{id:12,name:(a==null?void 0:a.call_type)??"N/A"},13:{id:13,name:(a==null?void 0:a.purchase_date)??"N/A"},14:{id:14,name:(a==null?void 0:a.zip_code)??"N/A"},15:{id:15,name:(a==null?void 0:a.country)??"N/A"},16:{id:16,name:(a==null?void 0:a.state)??"N/A"},17:{id:17,name:(a==null?void 0:a.city)??"N/A"},18:{id:18,name:(a==null?void 0:a.address)??"N/A"},19:{id:19,name:(a==null?void 0:a.issue)??"N/A"},20:{id:20,name:(a==null?void 0:a.status)??"N/A"},21:{id:21,name:(a==null?void 0:a.reason_to_close)??"N/A"},22:{id:22,name:((t=a.receipt)==null?void 0:t.discount)??"N/A"},23:{id:23,name:((n=a.decision_making)==null?void 0:n.after_discount)??"N/A"},24:{id:24,name:((r=a.receipt)==null?void 0:r.retailers_price)??"N/A"},25:{id:25,name:((w=a.decision_making)==null?void 0:w.cost_of_unit)??"N/A"},26:{id:26,name:((S=a.decision_making)==null?void 0:S.shipping_cost)??"N/A"},27:{id:27,name:((y=a.replacement)==null?void 0:y.ship_date)??"N/A"},28:{id:28,name:((b=a.replacement)==null?void 0:b.tracking)??"N/A"},29:{id:29,name:((v=a.refund)==null?void 0:v.ship_date)??"N/A"},30:{id:30,name:((j=a.refund)==null?void 0:j.cheque_no)??"N/A"},31:{id:31,name:((D=a.refund)==null?void 0:D.cheque_amount)??"N/A"},32:{id:32,name:(a.country=="CA"?"CAD":"USD")??"N/A"},33:{id:33,name:((E=a.receipt)==null?void 0:E.store)??"N/A"}}}),k=(await z()).sort((a,t)=>a.id-t.id),x=G.map(a=>A.map(t=>a[t]).sort((t,n)=>t.id-n.id)),o=[k.map(a=>a.name),...x.map(a=>a.map(t=>t.name))],m=l.aoa_to_sheet(o);console.log("new_column",k),console.log("new_data",x),console.log("export_data",o);const V={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2F75B5"}}};for(let a=0;a<o[0].length;a++){const t=l.encode_cell({r:0,c:a});m[t]||(m[t]={}),m[t].s=V}const W=o[0].map((a,t)=>Math.max(...o.map(n=>(n[t]?n[t].toString():"").length)));m["!cols"]=W.map(a=>({wch:a+2}));const C=l.book_new();l.book_append_sheet(C,m,"Sheet1"),Q(C,new Date().getTime()+".xlsx");const Z=(await s()).map(a=>a.id);K(Z),window.location.hash==""?F.dispatch(R(window.location.search)):F.dispatch(R("?search="+window.location.hash.slice(1))),h(!1)},g=()=>{f(!1)};return d.useEffect(()=>{h(!1)},[]),e.jsxs("div",{children:[e.jsx(_,{type:"primary",onClick:O,children:"Export Case Files"}),e.jsxs(X,{title:"Export Data",open:P,footer:[e.jsx(_,{onClick:g,children:"Cancel"},"back"),e.jsx(_,{type:"primary",loading:q,onClick:I,children:"Submit"},"submit")],onCancel:g,children:[e.jsxs(p.Group,{onChange:U,value:c,children:[e.jsx(p,{value:"all",children:"Export All"}),e.jsx(p,{value:"checked",children:"Export Checked"}),e.jsx(p,{value:"uncheck",children:"Export Uncheck"})]}),e.jsx("div",{className:"font-bold py-2",children:"Select table column"}),e.jsx(Y,{mode:"tags",style:{width:"100%"},placeholder:"select column",onChange:B,tokenSeparators:[","],options:N.map((i,s)=>({value:i.id,label:i.name}))})]})]})}export{Ma as default};
