import{r as T,j as C,s as q}from"./page-Dvv0qJ3J.js";import{g as E}from"./tickets-thunk-DtD1fyJr.js";import{u as l,w as L}from"./xlsx-769MyM77.js";import{u as U}from"./app-B67cHjqc.js";import{v as j,b as B}from"./tickets-service-mCMRaBAa.js";import{h as d}from"./page-BAw4YptE.js";import{B as I}from"./button-B46zw2rX.js";import{R as O}from"./FileDoneOutlined-CoIeIgfM.js";import"./internals-service-B9kSbxh_.js";import"./index-Dhfa0PVB.js";import"./asyncToGenerator-4CBB0d_K.js";import"./compact-item-DED6eBPk.js";import"./render-DTHsa77w.js";function et(){const[x,n]=T.useState(!1);U(i=>i.tickets);const F=new URLSearchParams(window.location.search).get("search"),P=i=>{if(!i)return"N/A";const c=i.replace(/[^\d]/g,"");return c.length!==10?"N/A":c.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3")};async function b(){n(!0);try{const i=await q.dispatch(E(window.location.search)),c=await j(window.location.search);async function u(){const m=c.data;n(!1),console.log("allTickets",m);let r=[],o=[];F=="RESOURCE"?(r=m.map(t=>{var e,a;return[d((e=t==null?void 0:t.receipt)==null?void 0:e.updated_at).format("L"),t.ticket_id,((a=t.validator)==null?void 0:a.name)??"N/A"]}),r.sort((t,e)=>new Date(t[0])-new Date(e[0])),o=[["Validated Date","Ticket Number","Agent Name"],...r]):(r=m.map(t=>{var e,a,p,_,h,N,A,g,w,k,y,S,D;return[d(t.created_at).format("L"),d(t.updated_at).format("L"),t.ticket_id??"N/A",t.fname??"N/A",t.lname??"N/A",P(t.phone),t.email??"N/A",t.serial_number??"N/A",t.item_number??"N/A",t.unit??"N/A",t.class??"N/A",t.brand??"N/A",t.call_type??"N/A",t.purchase_date??"N/A",t.zip_code??"N/A",t.country??"N/A",t.state??"N/A",t.city??"N/A",t.address??"N/A",t.issue??"N/A",t.status??"N/A",t.reason_to_close??"N/A",((e=t.receipt)==null?void 0:e.discount)??"N/A",((a=t.decision_making)==null?void 0:a.after_discount)??"N/A",((p=t.receipt)==null?void 0:p.retailers_price)??"N/A",((_=t.decision_making)==null?void 0:_.cost_of_unit)??"0",((h=t.decision_making)==null?void 0:h.shipping_cost)??"0",((N=t.replacement)==null?void 0:N.ship_date)??"N/A",((A=t.replacement)==null?void 0:A.tracking)??"N/A",((g=t.refund)==null?void 0:g.ship_date)??"N/A",((w=t.refund)==null?void 0:w.cheque_no)??"N/A",((k=t.refund)==null?void 0:k.cheque_amount)??"N/A",(t.country=="CA"?"CAD":"USD")??"N/A",((y=t.receipt)==null?void 0:y.store)??"N/A","No",(t.isUploading=="true"?"YES":"NO")??"NO",t.status??"N/A",(S=t==null?void 0:t.validate)!=null&&S.created_at?d((D=t==null?void 0:t.validate)==null?void 0:D.created_at).format("L"):"N/A"]}),o=[["Date Created","Date Last Updated","Ticket #","First Name","Last Name","Phone","Email","Serial #","Model #","Unit","Item Class","Brand","Resolution","Purchase Date","Zipcode","Country","State","City","Address","Issue","Ticket Status","Reason","Discount","Price After Discount","Purchase Price","Cost Price","Shipping Cost","Replacement Ship Date","Tracking #","Cheque Ship Date","Cheque #","Cheque Amount","Cheque Currency","Retail Store","From Parts","Is Downloaded","Warranty Decision","Validation Date"],...r]),console.log("export_data",o);const s=l.aoa_to_sheet(o),v={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2F75B5"}}};for(let t=0;t<o[0].length;t++){const e=l.encode_cell({r:0,c:t});s[e]||(s[e]={}),s[e].s=v}const R=o[0].map((t,e)=>Math.max(...o.map(a=>(a[e]?a[e].toString():"").length)));s["!cols"]=R.map(t=>({wch:t+2}));const f=l.book_new();l.book_append_sheet(f,s,"Sheet1"),L(f,new Date().getTime()+".xlsx")}c.result=="unexist"?(u(),B(window.location.search)):(window.confirm("The File is already downloaded. Press ok to continue to download")&&u(),n(!1))}catch{n(!1)}}return C.jsx(I,{loading:x,onClick:b,type:"primary",size:"large",icon:C.jsx(O,{}),children:"Export File"})}export{et as default};
