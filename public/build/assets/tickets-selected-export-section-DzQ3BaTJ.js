import{r as c,j as i,s as N}from"./page-Dvv0qJ3J.js";import{u as G}from"./app-FODnbHjf.js";import{v as I,u as V}from"./tickets-service-mCMRaBAa.js";import{u as p,w as W}from"./xlsx-769MyM77.js";import{h as Z}from"./page-BAw4YptE.js";import{g as S}from"./tickets-thunk-DtD1fyJr.js";import{B as h}from"./button-B46zw2rX.js";import{M as H}from"./index-BNqko_g7.js";import{R as s}from"./index-DuI_cUiT.js";import{S as J}from"./index-eRA5jUs8.js";import"./index-Dhfa0PVB.js";import"./internals-service-B9kSbxh_.js";import"./asyncToGenerator-4CBB0d_K.js";import"./compact-item-DED6eBPk.js";import"./render-DTHsa77w.js";import"./CheckCircleFilled-DhQ58IKX.js";import"./pickAttrs-DXOBWheU.js";import"./InfoCircleFilled-BwfJRIQR.js";import"./useZIndex-CAV2DYA6.js";import"./motion-4S5rSXvC.js";import"./Modal-KAzrSkgm.js";import"./index-BpLXbsWN.js";import"./motion-hCjoDOCy.js";import"./KeyCode-DNlgD2sM.js";import"./fade-B72Lb6Sh.js";import"./zoom-CF9pfhEi.js";import"./ContextIsolator-DSupELwk.js";import"./useClosable-Co8Ik_Ab.js";import"./useCSSVarCls-DypPsKon.js";import"./useLocale-OkCRZnVN.js";import"./PurePanel-D3TA6JpG.js";import"./index-CLk3OxlJ.js";import"./Overflow-DaNgDrM-.js";import"./useIcons-BDPKqi7z.js";import"./CheckOutlined-CEU17H7Q.js";function Dt({selected:K}){const[v,u]=c.useState(!1),[y,f]=c.useState(!1);G(o=>o.tickets);const[_,b]=c.useState("all"),[d,j]=c.useState([]),x=[{id:0,name:"Date Last Updated"},{id:1,name:"Ticket #"},{id:2,name:"Ticket Status"},{id:3,name:"Model #"},{id:4,name:"Item Class"},{id:5,name:"Price After Discount"},{id:6,name:"Cheque Currency"},{id:7,name:"Cost Price"},{id:8,name:"Shipping Cost"},{id:9,name:"First Name"},{id:10,name:"Last Name"},{id:11,name:"Address"},{id:12,name:"City"},{id:13,name:"State"},{id:14,name:"Zipcode"},{id:15,name:"Phone"},{id:16,name:"Email"},{id:17,name:"Serial #"},{id:18,name:"Retail Store"},{id:19,name:"Purchase Date"}],E=o=>{console.log("selected ",o),j(o)},F=o=>{console.log("radio checked",o.target.value),b(o.target.value)},D=()=>{f(!0)},M=async()=>{u(!0),console.log(window.location.search);const o=await I(window.location.search+"&export="+_);async function l(t){return o.data}console.log("exist.data",l());async function L(t){return x.filter(a=>d.includes(a.id))}const P=(await l()).map(t=>{var a,e,r,A,w,C;return{0:{id:0,name:(a=t==null?void 0:t.validate)!=null&&a.created_at?"N/A":Z((e=t==null?void 0:t.validate)==null?void 0:e.created_at).format("L")},1:{id:1,name:(t==null?void 0:t.ticket_id)??"N/A"},2:{id:2,name:(t==null?void 0:t.status)??"N/A"},3:{id:3,name:(t==null?void 0:t.item_number)??"N/A"},4:{id:4,name:(t==null?void 0:t.class)??"N/A"},5:{id:5,name:((r=t.decision_making)==null?void 0:r.after_discount)??"N/A"},6:{id:6,name:(t.country=="CA"?"CAD":"USD")??"N/A"},7:{id:7,name:((A=t.decision_making)==null?void 0:A.cost_of_unit)??"N/A"},8:{id:8,name:((w=t.decision_making)==null?void 0:w.shipping_cost)??"N/A"},9:{id:9,name:(t==null?void 0:t.fname)??"N/A"},10:{id:10,name:(t==null?void 0:t.lname)??"N/A"},11:{id:11,name:(t==null?void 0:t.address)??"N/A"},12:{id:12,name:(t==null?void 0:t.city)??"N/A"},13:{id:13,name:(t==null?void 0:t.state)??"N/A"},14:{id:14,name:(t==null?void 0:t.zip_code)??"N/A"},15:{id:15,name:(t==null?void 0:t.phone)??"N/A"},16:{id:16,name:(t==null?void 0:t.email)??"N/A"},17:{id:17,name:(t==null?void 0:t.serial_number)??"N/A"},18:{id:18,name:((C=t.receipt)==null?void 0:C.store)??"N/A"},19:{id:19,name:(t==null?void 0:t.purchase_date)??"N/A"}}}),R=await L(),T=P.map(t=>d.map(a=>t[a])),B=d.map(t=>R.find(a=>a.id===t)),O=T.map(t=>d.map(a=>t.find(e=>e.id===a))),n=[B.map(t=>t.name),...O.map(t=>t.map(a=>a.name))];console.log("export_data",n);const m=p.aoa_to_sheet(n),U={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2F75B5"}}};for(let t=0;t<n[0].length;t++){const a=p.encode_cell({r:0,c:t});m[a]||(m[a]={}),m[a].s=U}const q=n[0].map((t,a)=>Math.max(...n.map(e=>(e[a]?e[a].toString():"").length)));m["!cols"]=q.map(t=>({wch:t+2}));const k=p.book_new();p.book_append_sheet(k,m,"Sheet1"),W(k,new Date().getTime()+".xlsx");const z=(await l()).map(t=>t.id);V(z),window.location.hash==""?N.dispatch(S(window.location.search)):N.dispatch(S("?search="+window.location.hash.slice(1))),u(!1)},g=()=>{f(!1)};return c.useEffect(()=>{u(!1)},[]),i.jsxs("div",{children:[i.jsx(h,{type:"primary",onClick:D,children:"Export Case Files"}),i.jsxs(H,{title:"Export Data",open:y,footer:[i.jsx(h,{onClick:g,children:"Cancel"},"back"),i.jsx(h,{type:"primary",loading:v,onClick:M,children:"Submit"},"submit")],onCancel:g,children:[i.jsxs(s.Group,{onChange:F,value:_,children:[i.jsx(s,{value:"all",children:"Export All"}),i.jsx(s,{value:"checked",children:"Export Checked"}),i.jsx(s,{value:"uncheck",children:"Export Uncheck"})]}),i.jsx("div",{className:"font-bold py-2",children:"Select table column"}),i.jsx(J,{mode:"tags",style:{width:"100%"},placeholder:"select column",onChange:E,tokenSeparators:[","],options:x.map((o,l)=>({value:o.id,label:o.name}))})]})]})}export{Dt as default};
