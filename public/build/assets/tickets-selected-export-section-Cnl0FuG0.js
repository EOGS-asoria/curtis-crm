import{r as c,j as e,s as v}from"./page-ch7AsIzP.js";import{u as I}from"./app-C1s0fEFq.js";import{v as V,u as W}from"./tickets-service-CKn-hEjY.js";import{u as p,w as Z}from"./xlsx-769MyM77.js";import{h as H}from"./page-CfrH9CDr.js";import{g as y}from"./tickets-thunk-uBkgddiA.js";import{B as f}from"./button-Qo8-TZ9g.js";import{M as J}from"./index-BACUEx04.js";import{R as s}from"./index-CnKFXJpZ.js";import{S as K}from"./index-CUqrCOI5.js";import"./index-k6KU01t5.js";import"./internals-service-B9kSbxh_.js";import"./asyncToGenerator-1G8vEj8s.js";import"./compact-item-DdTtj5So.js";import"./render-BVKagQI8.js";import"./CheckCircleFilled-Decm9dyN.js";import"./pickAttrs-SrrbshNR.js";import"./InfoCircleFilled-eQBaOCtc.js";import"./useZIndex-CaQg4lWk.js";import"./motion-4S5rSXvC.js";import"./Modal-4B6JKVfO.js";import"./index-B88Ejp4W.js";import"./index-mf6ioYG1.js";import"./KeyCode-DNlgD2sM.js";import"./fade-BRA5nTkl.js";import"./zoom-DSCnx-FX.js";import"./ContextIsolator-DeP6EsIi.js";import"./useClosable-CLTPwS5-.js";import"./useCSSVarCls-ChRbnEBV.js";import"./useLocale-De3Ei8eB.js";import"./PurePanel-CteU8erQ.js";import"./Overflow-2UsTlSiO.js";import"./useIcons-DJhXt3_u.js";function Et({selected:_}){const[b,u]=c.useState(!1),[j,g]=c.useState(!1);I(i=>i.tickets);const[m,E]=c.useState("all"),[d,F]=c.useState([]),k=[{id:0,name:"Date Last Updated"},{id:1,name:"Ticket #"},{id:2,name:"Ticket Status"},{id:3,name:"Model #"},{id:4,name:"Item Class"},{id:5,name:"Price After Discount"},{id:6,name:"Cheque Currency"},{id:7,name:"Cost Price"},{id:8,name:"Shipping Cost"},{id:9,name:"First Name"},{id:10,name:"Last Name"},{id:11,name:"Address"},{id:12,name:"City"},{id:13,name:"State"},{id:14,name:"Zipcode"},{id:15,name:"Phone"},{id:16,name:"Email"},{id:17,name:"Serial #"},{id:18,name:"Retail Store"},{id:19,name:"Purchase Date"}],D=i=>{console.log("selected ",i),F(i)},M=i=>{console.log("radio checked",i.target.value),E(i.target.value)},L=()=>{g(!0)},P=async()=>{u(!0),console.log(window.location.search);const i=await V(window.location.search);async function r(t){if(m=="all")return i.data;if(m=="uncheck")return i.data.filter(a=>!_.includes(a.id));if(m=="checked")return i.data.filter(a=>_.includes(a.id))}async function R(t){return k.filter(a=>d.includes(a.id))}const T=(await r()).map(t=>{var a,o,h,C,N,S;return{0:{id:0,name:(a=t==null?void 0:t.validate)!=null&&a.created_at?"N/A":H((o=t==null?void 0:t.validate)==null?void 0:o.created_at).format("L")},1:{id:1,name:(t==null?void 0:t.ticket_id)??"N/A"},2:{id:2,name:(t==null?void 0:t.status)??"N/A"},3:{id:3,name:(t==null?void 0:t.item_number)??"N/A"},4:{id:4,name:(t==null?void 0:t.class)??"N/A"},5:{id:5,name:((h=t.decision_making)==null?void 0:h.after_discount)??"N/A"},6:{id:6,name:(t.country=="CA"?"CAD":"USD")??"N/A"},7:{id:7,name:((C=t.decision_making)==null?void 0:C.cost_of_unit)??"N/A"},8:{id:8,name:((N=t.decision_making)==null?void 0:N.shipping_cost)??"N/A"},9:{id:9,name:(t==null?void 0:t.fname)??"N/A"},10:{id:10,name:(t==null?void 0:t.lname)??"N/A"},11:{id:11,name:(t==null?void 0:t.address)??"N/A"},12:{id:12,name:(t==null?void 0:t.city)??"N/A"},13:{id:13,name:(t==null?void 0:t.state)??"N/A"},14:{id:14,name:(t==null?void 0:t.zip_code)??"N/A"},15:{id:15,name:(t==null?void 0:t.phone)??"N/A"},16:{id:16,name:(t==null?void 0:t.email)??"N/A"},17:{id:17,name:(t==null?void 0:t.serial_number)??"N/A"},18:{id:18,name:((S=t.receipt)==null?void 0:S.store)??"N/A"},19:{id:19,name:(t==null?void 0:t.purchase_date)??"N/A"}}}),B=await R(),w=T.map(t=>d.map(a=>t[a])),O=d.map(t=>B.find(a=>a.id===t)),U=w.map(t=>d.map(a=>t.find(o=>o.id===a))),l=[O.map(t=>t.name),...U.map(t=>t.map(a=>a.name))];console.log("new_data",w);const n=p.aoa_to_sheet(l),q={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"2F75B5"}}};for(let t=0;t<l[0].length;t++){const a=p.encode_cell({r:0,c:t});n[a]||(n[a]={}),n[a].s=q}const z=l[0].map((t,a)=>Math.max(...l.map(o=>(o[a]?o[a].toString():"").length)));n["!cols"]=z.map(t=>({wch:t+2}));const A=p.book_new();p.book_append_sheet(A,n,"Sheet1"),Z(A,new Date().getTime()+".xlsx");const G=(await r()).map(t=>t.id);W(G),window.location.hash==""?v.dispatch(y(window.location.search)):v.dispatch(y("?search="+window.location.hash.slice(1))),u(!1)},x=()=>{g(!1)};return c.useEffect(()=>{u(!1)},[]),e.jsxs("div",{children:[e.jsx(f,{type:"primary",onClick:L,children:"Export Case Files"}),e.jsxs(J,{title:"Export Data",open:j,footer:[e.jsx(f,{onClick:x,children:"Cancel"},"back"),e.jsx(f,{type:"primary",loading:b,onClick:P,children:"Submit"},"submit")],onCancel:x,children:[e.jsxs(s.Group,{onChange:M,value:m,children:[e.jsx(s,{value:"all",children:"Export All"}),e.jsx(s,{value:"checked",children:"Export Checked"}),e.jsx(s,{value:"uncheck",children:"Export Uncheck"})]}),e.jsx("div",{className:"font-bold py-2",children:"Select table column"}),e.jsx(K,{mode:"tags",style:{width:"100%"},placeholder:"select column",onChange:D,tokenSeparators:[","],options:k.map((i,r)=>({value:i.id,label:i.name}))})]})]})}export{Et as default};
